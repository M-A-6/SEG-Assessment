@{
    ViewBag.Title = "Create/Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script>
    $(document).ready(function () {
        console.log(@ViewBag.EmployeeId);
        //Load Employee if exists
        if (@ViewBag.EmployeeId > 0) {

            $.ajax({
                url: 'http://localhost:4228/api/employee/' + @ViewBag.EmployeeId,
                method: 'GET',
                //dataType: 'json',
                headers: {
                    'authorization': 'bearer '
                        + sessionstorage.getitem("accesstoken")
                },
                //beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.getItem("accessToken") ); },
                success: function (data) {
                    $('#EmployeeId').val(data.EmployeeId);
                    $('#FirstName').val(data.FirstName);
                    $('#LastName').val(data.LastName);
                    $('#Email').val(data.Email);
                    $('#Gender').val(data.Gender);
                },
                error: function (jqXHR) {
                }
            });
        } else {
            //$('#EmployeeId').hide();
          //  $('#EmployeeId').prop("disabled", false);
        }

        $('#btnSave').click(function () {
             //Update Employee if exist
            if (@ViewBag.EmployeeId > 0) {
                $.ajax({
                    url: 'http://localhost:4228/api/employee/'+ @ViewBag.EmployeeId,
                    method: 'PUT',
                    headers: {
                        'authorization': 'bearer '
                            + sessionstorage.getitem("accesstoken")
                    },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify({
                        EmployeeId: $('#EmployeeId').val(),
                        FirstName: $('#FirstName').val(),
                        LastName: $('#LastName').val(),
                        Email: $('#Email').val(),
                        Gender: $('#Gender').val()                      
                    }),
                    success: function () {
                        window.location.href = "employee";
                    },
                    error: function (jqXHR) {
                        $('#divMessage').html(jqXHR.responseText);
                    }
                });
            }
            else {
                $.ajax({
                    url: 'http://localhost:4228/api/employees',
                    method: 'POST',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    headers: {
                        'authorization': 'bearer '
                            + sessionstorage.getitem("accesstoken")
                    },
                    data: JSON.stringify({
                        firstName: $('#FirstName').val(),
                        lastName: $('#LastName').val(),
                        email: $('#Email').val(),
                        gender: $('#Gender').val(),
                        employeeId: $('#EmployeeId').val(),
                    }),
                    success: function () {
                        window.location.href = "employee";
                    },
                    error: function (jqXHR) {

                    }
                });

            }
        });

    });

</script>

@if (@ViewBag.EmployeeId > 0)
{
  <h2>Edit Employeee</h2>
}
else { <h2>Add Employeee</h2>}



<div class="form-horizontal">
    <hr />
    <div class="form-group">
        <label class="control-label col-md-2"> Employee Id</label>
        <div class="col-md-10">
            <input type="text" class="form-control" id="EmployeeId" disabled />
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2"> First Name</label>
        <div class="col-md-10">
            <input type="text" class="form-control" id="FirstName" />
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2"> Last Name</label>
        <div class="col-md-10">
            <input type="text" class="form-control" id="LastName" />
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2"> Email</label>

        <div class="col-md-10">
            <input type="text" class="form-control" id="Email" />
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2"> Gender</label>
        <div class="col-md-10">
            <input type="text" class="form-control" id="Gender" />
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Save" class="btn btn-default" />
        </div>
    </div>
</div>


