@model IEnumerable<SEG.BOL.Employee>

@{
    ViewBag.Title = "Employee";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Employee List</h2>


<table id="employeeTable">
    <thead>
        <tr>
            <th>Edit</th>
            <th>Id</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Gender</th>
            <th>Email</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <th>Edit</th>
            <th>Id</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Gender</th>
            <th>Email</th>
            <th>Delete</th>
        </tr>
    </tfoot>

</table>

<link href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" rel="stylesheet" />
@* Load datatable js *@
<script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>

@*<script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>*@

<script>
   
    function GetAllEmployees() {
            $.ajax({
                url: 'http://localhost:4228/api/employee',
            method: 'GET',
            //dataType: 'json',
                headers: {
                    'authorization': 'bearer '
                        + sessionstorage.getitem("accesstoken")
                },
            //beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.getItem("accessToken") ); },
            success: function (data) {
                console.log(data);
                $('#employeeTable').dataTable({
                    responsive: true,
                    paging: true,
                    sort: true,
                    searching: true,
                    scrollY: 300,
                    data: data,
                    columns: [
                        {'data': 'EmployeeId',
                            'sortable': false,
                            'searchable': false,
                            'render': function (EmployeeId) {                                
                                return '<a class="btn btn-mini btn-warning" href="Employee/Edit/'+  EmployeeId +'"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>';
                            }
                        },
                        { 'data': 'EmployeeId' },
                        { 'data': 'FirstName' },
                        { 'data': 'LastName' },
                        { 'data': 'Gender' },
                        { 'data': 'Email' },
                        {'data': 'EmployeeId',
                            'sortable': false,
                            'searchable': false,
                            'render': function (EmployeeId) {
                                return '<a class="btn btn-mini btn-danger" onclick="deleteEmployee(' + EmployeeId + ');"> <i class="glyphicon glyphicon-minus-sign" aria-hidden="true"></i></a>';
                            }
                        },]
                });
                },
                error: function (jqXHR) {
                 //   window.location.href = "Employee/Login";
                }
        });
    }
    function deleteEmployee(id) {        
        var result = confirm("Want to delete?");
        if (result) {
            $.ajax({
                url: 'http://localhost:4228/api/employee/' + id,
                method: 'DELETE',
                headers: {
                    'authorization': 'bearer '
                        + sessionstorage.getitem("accesstoken")
                },    
                success: function (response) {
                    console.log(response);
                    window.location.reload();
                },
                // Display errors if any in the Bootstrap alert <div>
                error: function (jqXHR) {
                   // window.location.href = "Employee/Login";
                }
            });
        }
        
    }
    $(document).ready(function () {        
        console.log('Authorization: Bearer ' + sessionStorage.getItem('accessToken'));
        GetAllEmployees();
    });
</script>

@*glyphicon glyphicon-pencil*@



